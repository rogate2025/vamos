<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vamos Quiz</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1a0b2e, #0d1b2a);
            color: #fff;
            text-align: center;
            min-height: 100vh;
            margin: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        #clientMode, #displayMode { display: none; }
        #question, #clientQuestion {
            font-size: 36px;
            font-weight: bold;
            text-shadow: 0 0 10px #00b7eb, 0 0 20px #00b7eb;
            margin-bottom: 20px;
            animation: glow 2s infinite alternate;
        }
        @keyframes glow {
            from { text-shadow: 0 0 10px #00b7eb; }
            to { text-shadow: 0 0 20px #00b7eb, 0 0 30px #00b7eb; }
        }
        #zohoFormPopup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: radial-gradient(circle, #1c2526, #0d1b2a);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 30px #ffd700, 0 0 60px rgba(255, 215, 0, 0.5);
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 2000;
            border: 3px solid #ffd700;
            animation: popupFadeIn 0.5s ease-in-out;
        }
        @keyframes popupFadeIn {
            from { opacity: 0; transform: translate(-50%, -60%); }
            to { opacity: 1; transform: translate(-50%, -50%); }
        }
        #formCloseIcon {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            color: #ffd700;
            cursor: pointer;
            transition: all 0.3s;
        }
        #formCloseIcon:hover {
            color: #ffea00;
            text-shadow: 0 0 10px #ffd700;
        }
        iframe {
            width: 100%;
            height: 60vh;
            border: none;
            max-height: 500px;
            border-radius: 10px;
        }
        #mainContent { transition: filter 0.3s; }
        #mainContent.blur-background {
            filter: blur(5px);
            pointer-events: none;
        }
        #answersSection {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 51, 0.8);
            padding: 20px;
            border-radius: 20px;
            box-shadow: 0 0 30px #ffd700, 0 0 60px rgba(255, 215, 0, 0.5);
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 2000;
            border: 3px solid #ffd700;
            animation: popupFadeIn 0.5s ease-in-out;
        }
        #answersSection.show { display: block; }
        .answer-item {
            padding: 10px;
            margin: 5px 0;
            border-radius: 10px;
            font-size: 20px;
            text-align: left;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            box-shadow: 0 0 5px rgba(255, 215, 0, 0.3);
        }
        .correct {
            background: #00b7eb;
            box-shadow: 0 0 15px #00b7eb, 0 0 30px #00b7eb;
        }
        #closeIcon {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            color: #ffd700;
            cursor: pointer;
            transition: all 0.3s;
        }
        #closeIcon:hover {
            color: #ffea00;
            text-shadow: 0 0 10px #ffd700;
        }
        .button-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        button {
            padding: 15px 30px;
            font-size: 18px;
            background: linear-gradient(45deg, #ffd700, #ffea00);
            color: #000;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            box-shadow: 0 0 10px #ffd700, 0 0 20px rgba(255, 215, 0, 0.5);
            transition: all 0.3s;
        }
        button:hover {
            background: linear-gradient(45deg, #ffea00, #ffd700);
            box-shadow: 0 0 20px #ffd700, 0 0 40px rgba(255, 215, 0, 0.7);
            transform: scale(1.05);
        }
        @media (max-width: 768px) {
            #question, #clientQuestion { font-size: 24px; }
            button { padding: 10px 20px; font-size: 16px; }
            iframe { height: 50vh; }
            #zohoFormPopup, #answersSection { width: 95%; }
        }
    </style>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>
    <!-- Client Mode (Mobile Phones) -->
    <div id="clientMode">
        <div id="clientQuestion"></div>
        <div class="button-container">
            <button id="enterFormButton">Enter Form</button>
            <button id="showAnswersButtonClient">Show Answers</button>
        </div>
        <div id="zohoFormPopup">
            <span id="formCloseIcon">✖</span>
            <iframe src="https://forms.zohopublic.in/jijojohnsonk/form/VamosQuiz/formperma/KoOtHIfipbOn2n1B1hboCvESZTIRlsl9iI5px3ovan8" frameborder="0"></iframe>
        </div>
    </div>

    <!-- Display Mode (Laptop) -->
    <div id="displayMode">
        <div id="mainContent">
            <div id="question"></div>
            <div class="button-container">
                <button id="nextButton">Next Question</button>
                <button id="showAnswersButton">Show Answers</button>
                <button id="hideAnswersButton" style="display: none;">Hide Answers</button>
            </div>
        </div>
        <div id="answersSection">
            <span id="closeIcon">✖</span>
            <h2>Submitted Answers</h2>
            <div id="answersList"></div>
        </div>
    </div>

    <script>
        // Replace with your Firebase configuration
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        const questions = [
            { question: "What is the capital of Brazil?", answer: "Brasília" },
            { question: "Which planet is known as the Red Planet?", answer: "Mars" },
            { question: "What gas do plants primarily use for photosynthesis?", answer: "Carbon Dioxide" },
            { question: "Who wrote 'Romeo and Juliet'?", answer: "William Shakespeare" },
            { question: "What is the largest ocean on Earth?", answer: "Pacific Ocean" }
        ];

        // Determine mode from URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const mode = urlParams.get('mode') || 'client';
        const clientMode = document.getElementById('clientMode');
        const displayMode = document.getElementById('displayMode');
        if (mode === 'client') clientMode.style.display = 'block';
        else if (mode === 'display') displayMode.style.display = 'block';

        // Firebase references
        const currentQuestionIndexRef = database.ref('currentQuestionIndex');
        const submittedAnswersRef = database.ref('submittedAnswers');
        const showAnswersRef = database.ref('showAnswers');

        // Helper function to get current question index
        function getCurrentQuestionIndex() {
            return new Promise((resolve) => {
                currentQuestionIndexRef.once('value', (snapshot) => {
                    resolve(snapshot.val() || 0);
                });
            });
        }

        // Client Mode Logic (Mobile Phones)
        if (mode === 'client') {
            const clientQuestion = document.getElementById('clientQuestion');
            const enterFormButton = document.getElementById('enterFormButton');
            const showAnswersButtonClient = document.getElementById('showAnswersButtonClient');
            const zohoFormPopup = document.getElementById('zohoFormPopup');
            const formCloseIcon = document.getElementById('formCloseIcon');
            const correctPasskey = "3492";

            // Update question in real-time
            currentQuestionIndexRef.on('value', (snapshot) => {
                const index = snapshot.val() || 0;
                clientQuestion.textContent = questions[index].question;
            });

            // Show Zoho form popup
            enterFormButton.addEventListener('click', () => {
                zohoFormPopup.style.display = 'block';
            });

            // Close Zoho form popup
            formCloseIcon.addEventListener('click', () => {
                zohoFormPopup.style.display = 'none';
            });

            // Show answers with passkey
            showAnswersButtonClient.addEventListener('click', () => {
                const passkey = prompt("Enter the passkey to view answers:");
                if (passkey === correctPasskey) {
                    window.open('https://docs.google.com/spreadsheets/d/1Vo1KanS-nVl4W18pc0Vz1_khxb7a2gm6tCEEJWjRgv8/edit?gid=0#gid=0', '_blank');
                } else {
                    alert("Incorrect passkey! Please try again.");
                }
            });
        }

        // Display Mode Logic (Laptop)
        if (mode === 'display') {
            const questionText = document.getElementById('question');
            const answersSection = document.getElementById('answersSection');
            const answersList = document.getElementById('answersList');
            const nextButton = document.getElementById('nextButton');
            const showAnswersButton = document.getElementById('showAnswersButton');
            const hideAnswersButton = document.getElementById('hideAnswersButton');
            const mainContent = document.getElementById('mainContent');
            const closeIcon = document.getElementById('closeIcon');

            // Update question in real-time
            currentQuestionIndexRef.on('value', (snapshot) => {
                const index = snapshot.val() || 0;
                questionText.textContent = questions[index].question;
            });

            // Show/hide answers popup
            showAnswersRef.on('value', (snapshot) => {
                const show = snapshot.val();
                if (show) {
                    displayAnswers();
                    answersSection.style.display = 'block';
                    showAnswersButton.style.display = 'none';
                    hideAnswersButton.style.display = 'inline-block';
                    mainContent.classList.add('blur-background');
                } else {
                    answersSection.style.display = 'none';
                    showAnswersButton.style.display = 'inline-block';
                    hideAnswersButton.style.display = 'none';
                    mainContent.classList.remove('blur-background');
                }
            });

            // Display submitted answers (still uses Firebase)
            function displayAnswers() {
                answersList.innerHTML = '';
                getCurrentQuestionIndex().then((index) => {
                    submittedAnswersRef.once('value', (snapshot) => {
                        const answers = snapshot.val() || {};
                        const currentAnswers = Object.values(answers).filter(a => a.questionIndex === index);
                        currentAnswers.forEach((submission) => {
                            const answerDiv = document.createElement('div');
                            answerDiv.className = 'answer-item';
                            answerDiv.textContent = `Team ${submission.team}: ${submission.answer}`;
                            answersList.appendChild(answerDiv);
                        });
                        const correctDiv = document.createElement('div');
                        correctDiv.className = 'answer-item correct';
                        correctDiv.textContent = `Correct Answer: ${questions[index].answer}`;
                        answersList.appendChild(correctDiv);
                    });
                });
            }

            // Next question
            nextButton.addEventListener('click', () => {
                currentQuestionIndexRef.once('value', (snapshot) => {
                    const index = snapshot.val() || 0;
                    const nextIndex = (index + 1) % questions.length;
                    currentQuestionIndexRef.set(nextIndex);
                    submittedAnswersRef.remove(); // Clear answers for new question
                });
            });

            // Show answers
            showAnswersButton.addEventListener('click', () => {
                showAnswersRef.set(true);
            });

            // Hide answers
            hideAnswersButton.addEventListener('click', () => {
                showAnswersRef.set(false);
            });
            closeIcon.addEventListener('click', () => {
                showAnswersRef.set(false);
            });
        }
    </script>
</body>
</html>